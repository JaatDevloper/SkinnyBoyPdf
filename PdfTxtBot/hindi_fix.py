import re

def krutidev_to_unicode(text):
    # विस्तृत मैपिंग टेबल (Kruti Dev to Unicode)
    mapping = {
        '~': '़', '`': '़', '1': '१', '2': '२', '3': '३', '4': '४', '5': '५', '6': '६', '7': '७', '8': '८', '9': '९', '0': '०',
        'f': 'ि', 'k': 'ा', 'i': 'ी', 'u': 'ु', 'm': 'ु', 'n': 'ु', 'v': 'अ', 'a': 'अ', 's': 'ए', 'w': 'ाँ', 'W': 'ाँ',
        'q': 'ु', 'Q': 'ू', 'e': 'म', 'r': 'त', 't': 'ज', 'y': 'ब', 'z': 'भ', 'x': 'य', 'c': 'स', 'v': 'अ', 'b': 'ब', 'n': 'न', 
        'M': 'ा', 'A': 'ा', 'S': 'ै', 'D': 'क', 'F': 'त', 'G': 'ह', 'H': 'ी', 'J': 'र', 'K': 'ा', 'L': 'न', 'P': 'च',
        'V': 'ट', 'B': 'ब', 'N': 'न', 'O': 'प', 'I': 'प', 'U': 'ु', 'Y': 'ब', 'Z': 'भ', 'X': 'य', 'R': 'त', 'E': 'क',
        '[': 'ृ', ']': '।', 'ण्': '.', 'ए': 'ै', 'ो': 'ो', '्': '्', 'ा': 'ा', 'ी': 'ी', 'ु': 'ु', 'ू': 'ू', 'ृ': 'ृ',
        'े': 'े', 'ै': 'ै', 'ो': 'ो', 'ौ': 'ौ', 'ं': 'ं', 'ः': 'ः', '़': '़', 'ा': 'ा', 'ा': 'ा', 'ा': 'ा',
        ' ' : ' ', 'ण्' : '.', 'ं' : 'ं', 'ः' : 'ः', 'ा' : 'ा', 'ी' : 'ी', 'ु' : 'ु', 'ू' : 'ू', 'ृ' : 'ृ', 'े' : 'े', 'ै' : 'ै', 'ो' : 'ो', 'ौ' : 'ौ',
        'द्ध' : '1', 'इद्ध' : '2', 'बद्ध' : '3', 'कद्ध' : '4', 'ए' : 'ै', 'ै' : 'ै', 'ा' : 'ा', 'ा' : 'ा'
    }

    # Step 1: 'f' मात्रा को अक्षर के पीछे ले जाना (Fixing Matra)
    # Kruti Dev में 'f' पहले आता है (जैसे: fdy = दि), इसे (dyf) बनाना पड़ता है।
    text = re.sub(r'f([a-zA-Z])', r'\1f', text)
    
    # Step 2: आधे अक्षरों की 'h' मात्रा ठीक करना
    text = re.sub(r'([a-zA-Z])h', r'h\1', text)

    # Step 3: कैरेक्टर रिप्लेसमेंट
    res = ""
    for char in text:
        res += mapping.get(char, char)
    
    # Step 4: कुछ खास सुधार (जैसे 'ण्' को '.' में बदलना आपके टेक्स्ट के अनुसार)
    res = res.replace('ण्', '.')
    return res

def fix_file_content(content):
    lines = content.split('\n')
    fixed_lines = [krutidev_to_unicode(line) for line in lines]
    return '\n'.join(fixed_lines)
    
